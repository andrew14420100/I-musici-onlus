{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":89,"index":89}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":90},"end":{"line":2,"column":69,"index":159}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":193},"end":{"line":4,"column":51,"index":244}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/contexts/AuthContext.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useAuth\", {\n    enumerable: true,\n    get: function () {\n      return useAuth;\n    }\n  });\n  Object.defineProperty(exports, \"AuthProvider\", {\n    enumerable: true,\n    get: function () {\n      return AuthProvider;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _servicesApi = require(_dependencyMap[2], \"../services/api\");\n  var _reactJsxDevRuntime = require(_dependencyMap[3], \"react/jsx-dev-runtime\");\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  const useAuth = () => {\n    _s();\n    const context = (0, _react.useContext)(AuthContext);\n    if (!context) {\n      throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n  };\n  _s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n  const AuthProvider = ({\n    children\n  }) => {\n    _s2();\n    const [user, setUser] = (0, _react.useState)(null);\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const [isInitialized, setIsInitialized] = (0, _react.useState)(false);\n    const checkExistingSession = async () => {\n      try {\n        const token = await AsyncStorage.default.getItem('session_token');\n        console.log('Checking existing session, token exists:', !!token);\n        if (token) {\n          const userData = await _servicesApi.authApi.getMe();\n          console.log('Session valid, user:', userData.email, userData.ruolo);\n          setUser(userData);\n          return true;\n        }\n      } catch (error) {\n        console.log('No valid session');\n        await AsyncStorage.default.removeItem('session_token');\n      }\n      return false;\n    };\n    (0, _react.useEffect)(() => {\n      const init = async () => {\n        console.log('=== Auth Init Start ===');\n        setIsLoading(true);\n        setIsInitialized(false);\n\n        // First seed the database (silent)\n        try {\n          await _servicesApi.seedApi.seed();\n        } catch (e) {\n          // Ignore\n        }\n\n        // Check existing session\n        await checkExistingSession();\n        setIsLoading(false);\n        setIsInitialized(true);\n        console.log('=== Auth Init Complete ===');\n      };\n      init();\n    }, []);\n    const loginWithCredentials = async (email, password) => {\n      try {\n        console.log('Attempting login for:', email);\n        const response = await _servicesApi.authApi.login(email, password);\n        if (response.token) {\n          await AsyncStorage.default.setItem('session_token', response.token);\n          setUser(response.user);\n          console.log('Login successful for:', response.user.email);\n          return {\n            success: true\n          };\n        }\n        return {\n          success: false,\n          error: 'Token non ricevuto'\n        };\n      } catch (error) {\n        console.error('Login error:', error.response?.data || error.message);\n        return {\n          success: false,\n          error: error.response?.data?.detail || 'Errore durante il login'\n        };\n      }\n    };\n    const logout = async () => {\n      try {\n        await _servicesApi.authApi.logout();\n      } catch (error) {\n        // Ignore\n      }\n      await AsyncStorage.default.removeItem('session_token');\n      setUser(null);\n      console.log('Logged out');\n    };\n    const refreshUser = async () => {\n      await checkExistingSession();\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: {\n        user,\n        isLoading,\n        isInitialized,\n        isAuthenticated: !!user,\n        loginWithCredentials,\n        logout,\n        refreshUser\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 5\n    }, this);\n  };\n  _s2(AuthProvider, \"q9JbC2rb9mh990PF5u1+EBWV/uE=\");\n  _c = AuthProvider;\n  var _c;\n  $RefreshReg$(_c, \"AuthProvider\");\n});","lineCount":144,"map":[[15,2,18,0,"Object"],[15,8,18,0],[15,9,18,0,"defineProperty"],[15,23,18,0],[15,24,18,0,"exports"],[15,31,18,0],[16,4,18,0,"enumerable"],[16,14,18,0],[17,4,18,0,"get"],[17,7,18,0],[17,18,18,0,"get"],[17,19,18,0],[18,6,18,0],[18,13,18,0,"useAuth"],[18,20,18,0],[19,4,18,0],[20,2,18,0],[21,2,30,0,"Object"],[21,8,30,0],[21,9,30,0,"defineProperty"],[21,23,30,0],[21,24,30,0,"exports"],[21,31,30,0],[22,4,30,0,"enumerable"],[22,14,30,0],[23,4,30,0,"get"],[23,7,30,0],[23,18,30,0,"get"],[23,19,30,0],[24,6,30,0],[24,13,30,0,"AuthProvider"],[24,25,30,0],[25,4,30,0],[26,2,30,0],[27,2,1,0],[27,6,1,0,"_react"],[27,12,1,0],[27,15,1,0,"require"],[27,22,1,0],[27,23,1,0,"_dependencyMap"],[27,37,1,0],[28,2,2,0],[28,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[28,42,2,0],[28,45,2,0,"require"],[28,52,2,0],[28,53,2,0,"_dependencyMap"],[28,67,2,0],[29,2,2,0],[29,6,2,0,"AsyncStorage"],[29,18,2,0],[29,21,2,0,"_interopDefault"],[29,36,2,0],[29,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[29,73,2,0],[30,2,4,0],[30,6,4,0,"_servicesApi"],[30,18,4,0],[30,21,4,0,"require"],[30,28,4,0],[30,29,4,0,"_dependencyMap"],[30,43,4,0],[31,2,4,51],[31,6,4,51,"_reactJsxDevRuntime"],[31,25,4,51],[31,28,4,51,"require"],[31,35,4,51],[31,36,4,51,"_dependencyMap"],[31,50,4,51],[32,2,16,0],[32,8,16,6,"AuthContext"],[32,19,16,17],[32,35,16,20],[32,39,16,20,"createContext"],[32,45,16,33],[32,46,16,33,"createContext"],[32,59,16,33],[32,61,16,63,"undefined"],[32,70,16,72],[32,71,16,73],[33,2,18,7],[33,8,18,13,"useAuth"],[33,15,18,20],[33,18,18,23,"useAuth"],[33,19,18,23],[33,24,18,29],[34,4,18,29,"_s"],[34,6,18,29],[35,4,19,2],[35,10,19,8,"context"],[35,17,19,15],[35,20,19,18],[35,24,19,18,"useContext"],[35,30,19,28],[35,31,19,28,"useContext"],[35,41,19,28],[35,43,19,29,"AuthContext"],[35,54,19,40],[35,55,19,41],[36,4,20,2],[36,8,20,6],[36,9,20,7,"context"],[36,16,20,14],[36,18,20,16],[37,6,21,4],[37,12,21,10],[37,16,21,14,"Error"],[37,21,21,19],[37,22,21,20],[37,67,21,65],[37,68,21,66],[38,4,22,2],[39,4,23,2],[39,11,23,9,"context"],[39,18,23,16],[40,2,24,0],[40,3,24,1],[41,2,24,2,"_s"],[41,4,24,2],[41,5,18,13,"useAuth"],[41,12,18,20],[42,2,30,7],[42,8,30,13,"AuthProvider"],[42,20,30,54],[42,23,30,57,"AuthProvider"],[42,24,30,58],[43,4,30,60,"children"],[44,2,30,69],[44,3,30,70],[44,8,30,75],[45,4,30,75,"_s2"],[45,7,30,75],[46,4,31,2],[46,10,31,8],[46,11,31,9,"user"],[46,15,31,13],[46,17,31,15,"setUser"],[46,24,31,22],[46,25,31,23],[46,28,31,26],[46,32,31,26,"useState"],[46,38,31,34],[46,39,31,34,"useState"],[46,47,31,34],[46,49,31,48],[46,53,31,52],[46,54,31,53],[47,4,32,2],[47,10,32,8],[47,11,32,9,"isLoading"],[47,20,32,18],[47,22,32,20,"setIsLoading"],[47,34,32,32],[47,35,32,33],[47,38,32,36],[47,42,32,36,"useState"],[47,48,32,44],[47,49,32,44,"useState"],[47,57,32,44],[47,59,32,45],[47,63,32,49],[47,64,32,50],[48,4,33,2],[48,10,33,8],[48,11,33,9,"isInitialized"],[48,24,33,22],[48,26,33,24,"setIsInitialized"],[48,42,33,40],[48,43,33,41],[48,46,33,44],[48,50,33,44,"useState"],[48,56,33,52],[48,57,33,52,"useState"],[48,65,33,52],[48,67,33,53],[48,72,33,58],[48,73,33,59],[49,4,35,2],[49,10,35,8,"checkExistingSession"],[49,30,35,28],[49,33,35,31],[49,39,35,31,"checkExistingSession"],[49,40,35,31],[49,45,35,43],[50,6,36,4],[50,10,36,8],[51,8,37,6],[51,14,37,12,"token"],[51,19,37,17],[51,22,37,20],[51,28,37,26,"AsyncStorage"],[51,40,37,38],[51,41,37,38,"default"],[51,48,37,38],[51,49,37,39,"getItem"],[51,56,37,46],[51,57,37,47],[51,72,37,62],[51,73,37,63],[52,8,38,6,"console"],[52,15,38,13],[52,16,38,14,"log"],[52,19,38,17],[52,20,38,18],[52,62,38,60],[52,64,38,62],[52,65,38,63],[52,66,38,64,"token"],[52,71,38,69],[52,72,38,70],[53,8,39,6],[53,12,39,10,"token"],[53,17,39,15],[53,19,39,17],[54,10,40,8],[54,16,40,14,"userData"],[54,24,40,22],[54,27,40,25],[54,33,40,31,"authApi"],[54,45,40,38],[54,46,40,38,"authApi"],[54,53,40,38],[54,54,40,39,"getMe"],[54,59,40,44],[54,60,40,45],[54,61,40,46],[55,10,41,8,"console"],[55,17,41,15],[55,18,41,16,"log"],[55,21,41,19],[55,22,41,20],[55,44,41,42],[55,46,41,44,"userData"],[55,54,41,52],[55,55,41,53,"email"],[55,60,41,58],[55,62,41,60,"userData"],[55,70,41,68],[55,71,41,69,"ruolo"],[55,76,41,74],[55,77,41,75],[56,10,42,8,"setUser"],[56,17,42,15],[56,18,42,16,"userData"],[56,26,42,24],[56,27,42,25],[57,10,43,8],[57,17,43,15],[57,21,43,19],[58,8,44,6],[59,6,45,4],[59,7,45,5],[59,8,45,6],[59,15,45,13,"error"],[59,20,45,18],[59,22,45,20],[60,8,46,6,"console"],[60,15,46,13],[60,16,46,14,"log"],[60,19,46,17],[60,20,46,18],[60,38,46,36],[60,39,46,37],[61,8,47,6],[61,14,47,12,"AsyncStorage"],[61,26,47,24],[61,27,47,24,"default"],[61,34,47,24],[61,35,47,25,"removeItem"],[61,45,47,35],[61,46,47,36],[61,61,47,51],[61,62,47,52],[62,6,48,4],[63,6,49,4],[63,13,49,11],[63,18,49,16],[64,4,50,2],[64,5,50,3],[65,4,52,2],[65,8,52,2,"useEffect"],[65,14,52,11],[65,15,52,11,"useEffect"],[65,24,52,11],[65,26,52,12],[65,32,52,18],[66,6,53,4],[66,12,53,10,"init"],[66,16,53,14],[66,19,53,17],[66,25,53,17,"init"],[66,26,53,17],[66,31,53,29],[67,8,54,6,"console"],[67,15,54,13],[67,16,54,14,"log"],[67,19,54,17],[67,20,54,18],[67,45,54,43],[67,46,54,44],[68,8,55,6,"setIsLoading"],[68,20,55,18],[68,21,55,19],[68,25,55,23],[68,26,55,24],[69,8,56,6,"setIsInitialized"],[69,24,56,22],[69,25,56,23],[69,30,56,28],[69,31,56,29],[71,8,58,6],[72,8,59,6],[72,12,59,10],[73,10,60,8],[73,16,60,14,"seedApi"],[73,28,60,21],[73,29,60,21,"seedApi"],[73,36,60,21],[73,37,60,22,"seed"],[73,41,60,26],[73,42,60,27],[73,43,60,28],[74,8,61,6],[74,9,61,7],[74,10,61,8],[74,17,61,15,"e"],[74,18,61,16],[74,20,61,18],[75,10,62,8],[76,8,62,8],[78,8,65,6],[79,8,66,6],[79,14,66,12,"checkExistingSession"],[79,34,66,32],[79,35,66,33],[79,36,66,34],[80,8,68,6,"setIsLoading"],[80,20,68,18],[80,21,68,19],[80,26,68,24],[80,27,68,25],[81,8,69,6,"setIsInitialized"],[81,24,69,22],[81,25,69,23],[81,29,69,27],[81,30,69,28],[82,8,70,6,"console"],[82,15,70,13],[82,16,70,14,"log"],[82,19,70,17],[82,20,70,18],[82,48,70,46],[82,49,70,47],[83,6,71,4],[83,7,71,5],[84,6,73,4,"init"],[84,10,73,8],[84,11,73,9],[84,12,73,10],[85,4,74,2],[85,5,74,3],[85,7,74,5],[85,9,74,7],[85,10,74,8],[86,4,76,2],[86,10,76,8,"loginWithCredentials"],[86,30,76,28],[86,33,76,31],[86,39,76,31,"loginWithCredentials"],[86,40,76,38,"email"],[86,45,76,51],[86,47,76,53,"password"],[86,55,76,69],[86,60,76,121],[87,6,77,4],[87,10,77,8],[88,8,78,6,"console"],[88,15,78,13],[88,16,78,14,"log"],[88,19,78,17],[88,20,78,18],[88,43,78,41],[88,45,78,43,"email"],[88,50,78,48],[88,51,78,49],[89,8,79,6],[89,14,79,12,"response"],[89,22,79,20],[89,25,79,23],[89,31,79,29,"authApi"],[89,43,79,36],[89,44,79,36,"authApi"],[89,51,79,36],[89,52,79,37,"login"],[89,57,79,42],[89,58,79,43,"email"],[89,63,79,48],[89,65,79,50,"password"],[89,73,79,58],[89,74,79,59],[90,8,81,6],[90,12,81,10,"response"],[90,20,81,18],[90,21,81,19,"token"],[90,26,81,24],[90,28,81,26],[91,10,82,8],[91,16,82,14,"AsyncStorage"],[91,28,82,26],[91,29,82,26,"default"],[91,36,82,26],[91,37,82,27,"setItem"],[91,44,82,34],[91,45,82,35],[91,60,82,50],[91,62,82,52,"response"],[91,70,82,60],[91,71,82,61,"token"],[91,76,82,66],[91,77,82,67],[92,10,83,8,"setUser"],[92,17,83,15],[92,18,83,16,"response"],[92,26,83,24],[92,27,83,25,"user"],[92,31,83,29],[92,32,83,30],[93,10,84,8,"console"],[93,17,84,15],[93,18,84,16,"log"],[93,21,84,19],[93,22,84,20],[93,45,84,43],[93,47,84,45,"response"],[93,55,84,53],[93,56,84,54,"user"],[93,60,84,58],[93,61,84,59,"email"],[93,66,84,64],[93,67,84,65],[94,10,85,8],[94,17,85,15],[95,12,85,17,"success"],[95,19,85,24],[95,21,85,26],[96,10,85,31],[96,11,85,32],[97,8,86,6],[98,8,87,6],[98,15,87,13],[99,10,87,15,"success"],[99,17,87,22],[99,19,87,24],[99,24,87,29],[100,10,87,31,"error"],[100,15,87,36],[100,17,87,38],[101,8,87,59],[101,9,87,60],[102,6,88,4],[102,7,88,5],[102,8,88,6],[102,15,88,13,"error"],[102,20,88,23],[102,22,88,25],[103,8,89,6,"console"],[103,15,89,13],[103,16,89,14,"error"],[103,21,89,19],[103,22,89,20],[103,36,89,34],[103,38,89,36,"error"],[103,43,89,41],[103,44,89,42,"response"],[103,52,89,50],[103,54,89,52,"data"],[103,58,89,56],[103,62,89,60,"error"],[103,67,89,65],[103,68,89,66,"message"],[103,75,89,73],[103,76,89,74],[104,8,90,6],[104,15,90,13],[105,10,91,8,"success"],[105,17,91,15],[105,19,91,17],[105,24,91,22],[106,10,92,8,"error"],[106,15,92,13],[106,17,92,15,"error"],[106,22,92,20],[106,23,92,21,"response"],[106,31,92,29],[106,33,92,31,"data"],[106,37,92,35],[106,39,92,37,"detail"],[106,45,92,43],[106,49,92,47],[107,8,93,6],[107,9,93,7],[108,6,94,4],[109,4,95,2],[109,5,95,3],[110,4,97,2],[110,10,97,8,"logout"],[110,16,97,14],[110,19,97,17],[110,25,97,17,"logout"],[110,26,97,17],[110,31,97,29],[111,6,98,4],[111,10,98,8],[112,8,99,6],[112,14,99,12,"authApi"],[112,26,99,19],[112,27,99,19,"authApi"],[112,34,99,19],[112,35,99,20,"logout"],[112,41,99,26],[112,42,99,27],[112,43,99,28],[113,6,100,4],[113,7,100,5],[113,8,100,6],[113,15,100,13,"error"],[113,20,100,18],[113,22,100,20],[114,8,101,6],[115,6,101,6],[116,6,103,4],[116,12,103,10,"AsyncStorage"],[116,24,103,22],[116,25,103,22,"default"],[116,32,103,22],[116,33,103,23,"removeItem"],[116,43,103,33],[116,44,103,34],[116,59,103,49],[116,60,103,50],[117,6,104,4,"setUser"],[117,13,104,11],[117,14,104,12],[117,18,104,16],[117,19,104,17],[118,6,105,4,"console"],[118,13,105,11],[118,14,105,12,"log"],[118,17,105,15],[118,18,105,16],[118,30,105,28],[118,31,105,29],[119,4,106,2],[119,5,106,3],[120,4,108,2],[120,10,108,8,"refreshUser"],[120,21,108,19],[120,24,108,22],[120,30,108,22,"refreshUser"],[120,31,108,22],[120,36,108,34],[121,6,109,4],[121,12,109,10,"checkExistingSession"],[121,32,109,30],[121,33,109,31],[121,34,109,32],[122,4,110,2],[122,5,110,3],[123,4,112,2],[123,24,113,4],[123,28,113,4,"_reactJsxDevRuntime"],[123,47,113,4],[123,48,113,4,"jsxDEV"],[123,54,113,4],[123,56,113,5,"AuthContext"],[123,67,113,16],[123,68,113,17,"Provider"],[123,76,113,25],[124,6,114,6,"value"],[124,11,114,11],[124,13,114,13],[125,8,115,8,"user"],[125,12,115,12],[126,8,116,8,"isLoading"],[126,17,116,17],[127,8,117,8,"isInitialized"],[127,21,117,21],[128,8,118,8,"isAuthenticated"],[128,23,118,23],[128,25,118,25],[128,26,118,26],[128,27,118,27,"user"],[128,31,118,31],[129,8,119,8,"loginWithCredentials"],[129,28,119,28],[130,8,120,8,"logout"],[130,14,120,14],[131,8,121,8,"refreshUser"],[132,6,122,6],[132,7,122,8],[133,6,122,8,"children"],[133,14,122,8],[133,16,124,7,"children"],[134,4,124,15],[135,6,124,15,"fileName"],[135,14,124,15],[135,16,124,15,"_jsxFileName"],[135,28,124,15],[136,6,124,15,"lineNumber"],[136,16,124,15],[137,6,124,15,"columnNumber"],[137,18,124,15],[138,4,124,15],[138,11,125,26],[138,12,125,27],[139,2,127,0],[139,3,127,1],[140,2,127,2,"_s2"],[140,5,127,2],[140,6,30,13,"AuthProvider"],[140,18,30,54],[141,2,30,54,"_c"],[141,4,30,54],[141,7,30,13,"AuthProvider"],[141,19,30,54],[142,2,30,54],[142,6,30,54,"_c"],[142,8,30,54],[143,2,30,54,"$RefreshReg$"],[143,14,30,54],[143,15,30,54,"_c"],[143,17,30,54],[144,0,30,54],[144,3]],"functionMap":{"names":["<global>","useAuth","AuthProvider","checkExistingSession","useEffect$argument_0","init","loginWithCredentials","logout","refreshUser"],"mappings":"AAA;uBCiB;CDM;yDEM;+BCK;GDe;YEE;iBCC;KDkB;GFG;+BIE;GJmB;iBKE;GLS;sBME;GNE;CFiB"},"hasCjsExports":false},"type":"js/module"}]}